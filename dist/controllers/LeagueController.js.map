{"version":3,"file":"LeagueController.js","sourceRoot":"/","sources":["controllers/LeagueController.ts"],"names":[],"mappings":"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","sourcesContent":["import { Prisma } from '@prisma/client'\nimport dayjs from 'dayjs'\n\nimport { IDefaultQueryResponse, LeaguesQueryParams } from './interface/fixtures'\nimport { BaseController } from './BaseController'\n\nclass LeagueController extends BaseController {\n  async getAllLeagues() {\n    try {\n      const queryParams: LeaguesQueryParams = this.req.query as LeaguesQueryParams\n      const where: Prisma.LeagueWhereInput = {\n        AND: [],\n      }\n      if (queryParams?.country) {\n        where.AND = [\n          ...(where.AND as []),\n          {\n            country: queryParams.country,\n          },\n        ]\n      }\n      if (queryParams?.year) {\n        where.AND = [\n          ...(where.AND as []),\n          {\n            season: queryParams.year,\n          },\n        ]\n      }\n      if (queryParams?.featured) {\n        where.AND = [\n          ...(where.AND as []),\n          {\n            featured: queryParams.featured,\n          },\n        ]\n      }\n      const take: number = isNaN(Number(queryParams?.pageSize)) ? 100 : Number(queryParams?.pageSize)\n\n      const skip: number = isNaN((Number(queryParams?.page) ?? 0) * take) ? 0 : (Number(queryParams?.page) ?? 0) * take\n\n      const leagues = await this.app.prisma.league.findMany({\n        where,\n        skip,\n        take,\n        include: {\n          _count: {\n            select: {\n              fixtures: {\n                where: {\n                  date: {\n                    gte: dayjs().toDate(),\n                  },\n                },\n              },\n            },\n          },\n        },\n      })\n      return this.res.status(200).send(<IDefaultQueryResponse>{\n        id: null,\n        success: true,\n        message: 'Success',\n        data: leagues.map((a) => ({ ...a, matches: a?._count?.fixtures })),\n      })\n    } catch (error) {\n      this.app.log.error(error)\n      this.app.Sentry.captureException(error)\n      return this.res.status(500).send(<IDefaultQueryResponse>{\n        id: null,\n        success: false,\n        message: 'Error! Something went wrong please try again',\n        data: [],\n      })\n    }\n  }\n  async getleague() {\n    try {\n      const id = Number((this.req.params as Record<string, any>)?.id)\n      const league = await this.app.prisma.league.findUnique({\n        where: {\n          id,\n        },\n      })\n\n      return this.res.status(200).send(<IDefaultQueryResponse>{\n        id: null,\n        success: true,\n        message: 'Success',\n        data: league,\n      })\n    } catch (error) {\n      this.app.Sentry.captureException(error)\n      this.app.log.error(error)\n      return this.res.status(500).send(<IDefaultQueryResponse>{\n        id: null,\n        success: false,\n        message: 'Error! Something went wrong please try again',\n        data: null,\n      })\n    }\n  }\n}\nexport default LeagueController\n"]}